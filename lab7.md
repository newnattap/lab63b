# การทดลองที่ 7 การเขียนโปรเเกรมเพื่อรันบนไมโครคอนโทรเลอร์

## วัตถุประสงค์
1. เพื่อศึกษาการเขียนโปรแกรมลงบนไมโครคอนโทรลเลอร์
2. เพื่อนำไมโครคอนโทรเลอร์ที่เขียนโปรเเกรมไปประยุกต์ใช้
3. เพื่อนำความรู้จากการทดลองที่ 1-6 มาประยุกต์ใช้
4. เพื่อออกเเบบระบบให้อาหารปลาอัตโนมัติ

## อุปกรณ์ที่ใช้
1. ไมโครคอนโทรเลอร์ ESP-01
2. สาย USB
3. USB to serial
4. อุปกรณ์และวัสดุประกอบโมเดลต่างๆ
![1_DoT_wf64FTcqAKuTJFaylA](https://user-images.githubusercontent.com/80880087/113093811-cd885100-921a-11eb-9e63-956076cf552e.jpeg)
5. Tower Pro SG90 Mini Micro Servo
![1_PAeEzlf9swQl42y_7KUUww](https://user-images.githubusercontent.com/80880087/113093838-dc6f0380-921a-11eb-9d51-c132f2f56d3c.jpeg)
6. Adapter
7. ขั้วชาร์ต
8. คอมพิวเตอร์

## ศึกษาข้อมูลเบื้องต้น
[03 run example 3](https://www.youtube.com/watch?v=CCnN1WJsXQY)

https://www.ioxhop.com/product/175/tower-pro-sg90-servo-micro

http://www.iot.codemobiles.com/product/341/tower-pro-sg90-mini-micro-servo

Servo คือ อุปกรณ์ทางกลที่ทำงานโดยการหมุน แต่แตกต่างจากมอเตอร์ทั่วๆไปตรงที่การหมุนสามารถกำหนดได้เป็นองศา Micro Servo ตัวนี้สามารถหมุนได้ตั้งแต่ 0 - 180 อาศา พร้อมการปรับค่า Error อัตโนมัติ 
## วิธีการทดลอง
1. นำ Adapter มาต่อเข้ากับ USB to serial (พอร์ต 0 สีขาว พอร์ต 1 สีเหลือง)
2. ต่อไมโครลคอนโทรลเลอร์และพอร์ทเข้าด้วยกัน
3. เปิด command prompt
4. เข้าโปรแกรมตัวอย่างโดยใช้คำสั่ง **cd pattani**
5. เลือกโปรแกรมคำสั่ง **cd 07_Output-Port** 
6. พิมพ์คำสั่ง vi src/main.cpp เพื่อดูโค้ดโปรแกรม
 ```c 
#include <Arduino.h>
#include <ESP8266WiFi.h>

int cnt = 0;

void setup()
{
 Serial.begin(115200);
 pinMode(0, OUTPUT);
 Serial.println("\n\n\n");
}

void loop()
{
 cnt++;
 if(cnt % 2) {
  Serial.println("========== ON ===========");
  digitalWrite(0, HIGH);
  delay(5) 
 } else {
  Serial.println("========== OFF ===========");
  digitalWrite(0, LOW);
  delay(43200)
}
```
7. ใช้คำสั่ง pio run -t upload เพื่ออัพโหลดโปรแกรมลงในไมโครคอนโทรนเลอร์
8. กดปุ่มสีดำบนไมโครคอนโทรเลอร์เพื่อให้ดาวโหลด และกดปุ่มรีเซ็ตสีแดงเพื่อรีเซ็ตคำสั่ง
9. ใช้คำสั่ง**pio device monitor** เพื่อดูผลลัพธ์
10. ต่อไมโครคอนโทรลเลอร์และTower Pro SG90 Mini Micro Servo เข้าด้วยกัน

## การบันทึกผลการทดลอง
จากการสังเกตผลลัพธ์จากการทดลองจะเห็นว่ารีเลย์จะทำงานเป็นช่วงทุกๆ 12 ชั่วโมง คือทุกๆ 12 ชั่วโมงรีเลย์จะ OFF เเละจะสลับมา ON 5 วินาทีให้เครื่องทำการให้อาหารปลา

## อภิปรายผลการทดลอง
จากการทดลอง เมื่อทำการอัพโหลดโปรแกรม 03_Output-Port ลงในตัวไมโครคอนโทรลเลอร์ และทำการรันคำสั่ง พบว่าผลลัพ์ที่แสดงบนหน้าจอคือ on และ off สลับกันไป 12 ชั่วโมง เเละ 5 วินาที และเมื่อนำไมโครคอนโทรลเลอร์ไปต่อกับหัวจ่ายอาหารก็จะพบว่าหัวจ่ายมีการจ่ายเเละหลุดจ่ายอาหารตามผลลัพธ์ on และ off ที่แสดงบนหน้าจอ นอกจากนี้หากนำไมโครคอนโทรลเลอร์ไปต่อกับ Relay ก็จะสามารถควบคุมการเปิดปิดสวิซ์ตามผลลัพธ์ on และ off ที่แสดงบนหน้าจอได้อีกด้วย

## คำถามหลังการทดลอง
หากต้องการให้เครื่องให้อาหารปลาอัติโนมัติมากขึ้นต้องทำอย่างไร

  -ตอบ ทำการปรับเลย์ให้ ON นานขึ้น


